### Compose, команда `docker compose`

Compose - это утилита для простого запуска нескольких docker контейнеров вместе

> Например сайт и база данных, в базе данных хранятся данные о ценах на машины, на сайте показываются эти цены и картинки машин)

Описываем мы то какие приложения будем запускать, с какими параметрами, какие порты пробрасывать и тд (похоже как параметры в docker run) в файле `compose.yml`

```yaml
services:
  prometheus:
    image: "prom/prometheus:v2.42.0"
    restart: unless-stopped
  grafana:
    image: "grafana/grafana:9.3.6"
    restart: unless-stopped
    environment:
      GF_SERVER_HTTP_PORT: 3000
    ports:
      - 8080:3000
```

|Поле|Значение|Пример
|-|-|-
|`services`|обявляем список сервисов (контейнеров которые будут работать в одной сети)|`services` только так писать xD
|`prometheus` и `grafana`|это наши имена сервисов которые мы им сами дали (можем дать и другие)|`grafana` можно, `GraFana` или `12221` - не нельзя
|`image`|задаем какой образ запускать| `"grafana/grafana:9.3.6"`, `grafana/grafana:latest`, `grafana/grafana`
|`restart`|правило что делать в случае если програма вылетит (завершится, упадет)|`unless-stopped` значит docker в случае если наше приложение сломается и завершит работу будет попытаться запустить его снова пока мы сами не остановим приложение
|`environment`| переменные которые мы передаем в контейнер и которые будет использовать приложение для конфигурации при запуске | `GF_SERVER_HTTP_PORT` переменная говорит Grafana на каком порту запускаться, у нас это 3000
|`ports`|прокидываем порты из контейнера на нашу машину| `8080:3000` значит что у нас на машине по пути `localhost:8080` будет доступна Графана которая работает в контейнере на порту 3000

### docker volumes вместе с простым примером использования в compose

По умолчанию данные на диске которые создает или меняет приложение во время работы контейнера будут удалены при остановке контейнера и не смогут использоваться при следующем запуске

В случае если мы хотим сохранть результаты работы программы в контейнере мы будем использовать volumes

> Например данные базы которая была запущена как контейнер и в которой мы созздали таблицу например

Volumes (тома) - используются для хранения данных которые создает или использует приложение запущенное как docker comtainer

- `docker volume ls` - посмотреть список существующих volumes
- `docker volume inspect ИМЯ_ТОМА` - посмотреть информацию о volume

> Есть еще `docker volume create ИМЯ_ТОМА` но обычно их автоматически создает compose или другие инструменты с помощью которых мы запускаем контейнеры

```yaml
services:
  postgres:
    image: "postgres:14.7-alpine"
    environment:
      POSTGRES_DB: mydb
      POSTGRES_USER: mydbuser
      POSTGRES_PASSWORD: mydbpassword
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
```
